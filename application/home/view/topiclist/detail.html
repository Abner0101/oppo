<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>穿白色毛衣吃火锅，你懂的</title>
	<link rel="stylesheet" type="text/css" href="__STATIC__/home/css/css.css">
	<style type="text/css">
		
	</style>
</head>
<body>
	
	<!-- 导航栏 -->
	{include file="../application/home/view/common/header.html" /}

	
	<section class="detailsMain">
		<span class="dropdown">
			<i></i>
			<div class="dropmenu" id="dropmenu">
				<a >举报</a>
				<a >收藏</a>
			</div>
		</span>
		<div class="detailsTop">
			<a href="" class="headPic">
				<img src="{$alist.toupic}">
			</a>
			<div class="headDetail">
				<h1><a href="">{$alist.username}</a></h1>
				<div>
					<span class="date"><i></i>{$alist.reg_date}</span>
					<span class="reading"><i></i>121108</span>
					<span class="reply"><i></i>2999</span>
				</div>
			</div>
		</div>
		<div class="detailsContent">
			<h1>{$alist.title}</h1>
			<p>
				{$alist.content}
			</p>
		</div>
		<ul class="detailsBtn">
			<li class="replyBtn"  onclick="showModal()">
				<i></i>
				<span>评论<em>{$count|count}</em></span>
			</li>
			<li class="likeBtn">
				<i></i>
				<span>评论<em>2999</em></span>
			</li>
			<li class="sugarBtn">
				<i></i>
				<span>评论<em>2999</em></span>
			</li>
		</ul>
	</section>
	<section class="detailsMain">
		<h1 class="replyHead">全部评论</h1>
		<ul class="replyMain" id="comment-list-box">
			
		</ul>
		<!-- <div><a href="javascript:loadComment()" id="next-btn">下一页</a></div> -->
	</section>

	<footer class="footer">
		<div>
			<a href="">OPPO论坛</a>
			<span>|</span>
			<a href="">OPPO乐园</a>
			<span>|</span>
			<a href="">OPPOR11</a>
			<span>|</span>
			<a href="">OPPOR9</a>
		</div>
		<p>
			<strong>   ©  2005 - 2017 广东欧珀移动通信有限公司 版权所有</strong> (
			<a href="" id="icp">粤ICP备08130115号-3</a> )
		</p>
	</footer>
<div id="screen-box-div" style="z-index:99;display: none; position: fixed;left: 0px; top:0px;width: 100%;height: 100%; background: rgb(0,0,0,0.4);">
	<div class="screen-box-item" style="position:absolute; relative;left: 50%;top: 50%;transform: translate(-50%,-50%);background: #fff;width: 700px;height: 430px; border-radius: 10px;">
		<div class="screen-box-item-title" style="text-align: left;padding-left: 20px;margin-top: 10px;">
			<font style="font-size: 20px;">评论</font>
			<a onclick="hideModal();" style="text-align: center;position: absolute;right: 20px;top: 0px; font-size: 35px;">×</a>
		</div>

		<div style="height: auto;padding: 10px 30px;">

			<div style="border-radius: 5px;width: 100%;height: 250px;padding: 5px;border: 1px solid #CCC;text-align: left;outline-color:#05b570;outline-width:thin;overflow-y :auto;" contenteditable="true" id="comment-content"></div>

			<div class="form-control mt2 text-left" style="position: relative;left:0px;">
				<button class="btn btn-brand right" id="submit-btn" type="submit" onclick="dosumit();" style="background: #0F9D09;border-radius: 15px; border: 1px #0F9D09 solid; color: #fff;font-size:15px;width: 100px;height: 50px;position: absolute;right: 20px;top:30px;">评论(S)</button> 

				<button class="btn btn-brand right" id="submit-btn_re" type="submit" onclick="otherdosumit();" style="background: #0F9D09;border-radius: 15px; border: 1px #0F9D09 solid; color: #fff;font-size:15px;width: 100px;height: 50px;position: absolute;right: 20px;top:30px;">评论(O)<input id="other_submit-btn_re" type="hidden" name="" ></button> 

				<a class="Emot option mr1" onclick="showEmoji();" style="visibility: visible;"><i class="op-icon icon-p-emoji"></i></a>

				<a class="Image" style="visibility: visible;position: relative;cursor: pointer;"><i class="op-icon icon-p-pic"><img src="/static/home/images/pic.png" style="width: 50px;position: absolute;top: 10px;"></i>
				<input type="file" name="upimgs" style="width: 32px;height: 28px;position: absolute;top:25px;left:0px;z-index: 2;background: none;opacity: 0;vertical-align: middle;cursor: pointer;background: red;" onchange="upImg(this);" id="upfile_img"></a>

				<div class="screen-box-item" id="emoji-box" style="position: absolute; left: 10px; height: 200px; width:100%;right:10px;bottom: 10px; background: rgb(255, 255, 255);overflow: hidden; padding-bottom: 10px; border-radius: 3px; display: none;border: 1px #ACABAB solid">
					<div class="screen-box-item-title" style="text-align: left;padding-left: 20px;padding:0px;">
						<a onclick="hideEmoji();" style="text-align: center;border: none;width: auto;height: auto;line-height: 26px;margin-right: 5px;font-size: 20px;">×</a>
					</div>
					<div style="height: 230px;padding: 0px;overflow-y :auto;padding-bottom: 30px;">
						{for start="1" end="132"}
						<img src="/static/home/images/qq/{$i}.gif">
						{/for}
					</div>
					<input type="hidden" id="comment_id_hide">
				</div>
				<a><i onclick="showEmoji()"><img src="/static/home/images/ejom.png" style="width: 45px;position: absolute;margin-left: 70px;"></i></a>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript" src="__STATIC__/home/js/jquery.min.js"></script>
<script type="text/javascript">
var noteid={$alist.id};
var pageno =1;


//滚动加载评论
var isbool=true;
$(window).scroll(function(){
	console.log($(this).scrollTop()+$(window).height());
	console.log($(document).height());
	if(($(this).scrollTop()+$(window).height()+1)>=$(document).height() && isbool==true){
		isbool=false;
		$.get('/home/comment/comlist',{'noteid':noteid,'pageno':pageno},
		function(ret){
			if (ret.code == 1) {
				$('#comment-list-box').append(ret.data);
				pageno++;

				
			}
			else
			{
				$('#next-btn').html("没有啦");
			}
			isbool=true;

		});
	}
});

function loadrecomment(comid){
	$('#look_comment_'+comid).fadeOut();
	$('#hide_comment_'+comid).fadeIn();
	$.get('/home/comment/recomlist',{'comid':comid},function(ret){
		if (ret.code == 1) {
				$('#recomment_content_box_'+comid).append(ret.data);
			}
			else
			{
				$('#hide_comment_'+comid).html('暂无评论');
			}
	});
}

function hidecomment(comid){
	$('#look_comment_'+comid).fadeIn();
	$('#hide_comment_'+comid).fadeOut();
	$('.recomment_content_'+comid).remove();
}
// var comid=$('#reply_comment').val();

//点击事件加载评论
// function loadComment()
// {
// 	$.get('/home/comment/comlist',{'noteid':noteid,'pageno':pageno},
// 		function(ret){
// 			if (ret.code == 1) {
// 				$('#comment-list-box').append(ret.data);
// 				pageno++;
// 			}
// 			else
// 			{
// 				$('#next-btn').html("没有啦");
// 			}
// 		});
// }
// loadComment();

function upImg(obj)
{
	var objFile = document.getElementById("upfile_img");
    if( objFile.value == "" ) {
        return;
    }
    var formdata = new FormData(); 
	formdata.append("img" , $("#upfile_img")[0].files[0]);//获取文件法二
	
  	$.ajax({
	    type : 'post',
	    url : '/home/note/upimg',
	    data : formdata,
	    cache : false,
	    processData : false, // 不处理发送的数据，因为data值是Formdata对象，不需要对数据做处理
	    contentType : false, // 不设置Content-type请求头
	    success : function(ret){
	    	var html = "<img src='"+ret+"' style='max-width: 100px;' />";
			$('#comment-content').append(html);
	    },
	    error : function(){ }
	});
}

function otherdosumit(){
	var data={};
	data.content=$('#comment-content').html();
	data.noteid=noteid;
	data.comid=$('#other_submit-btn_re').val();
	// alert($('#other_submit-btn_re').val());
	// console.log(data.comid);
	$.post('/home/comment/readd',data,function(ret){
		if ( ret.code == 0 )
		{
			if ( ret.data == 0 )
			{
				window.location.href = ret.url;
			}
			else
			{
				alert(ret.msg);
			}
		}
		else
		{
			alert("评论成功");
			$('#comment-content').html('');
			hideModal();
		}
	},'json');
	
}
function dosumit(){
	var data={};
	data.content=$('#comment-content').html();
	data.noteid=noteid;
	$.post('/home/comment/add',data,function(ret){
		if ( ret.code == 0 )
		{
			if ( ret.data == 0 )
			{
				window.location.href = ret.url;
			}
			else
			{
				alert(ret.msg);
			}
		}
		else
		{
			alert("评论成功");
			$('#comment-content').html('');
			hideModal();
		}
	},'json');
	
}
function showEmoji()
{
	$('#emoji-box').slideDown();
}
function hideEmoji()
{
	$('#emoji-box').slideUp();
}

$('#emoji-box').find('img').click(function(){
	var imgsrc = $(this).attr('src');
	var html = "<img src='"+imgsrc+"' />";
	$('#comment-content').append(html);
	$('#emoji-box').slideUp();

});


function showModal()
{
	$('#screen-box-div').fadeIn();
	$('#submit-btn').fadeIn();
	$('#submit-btn_re').fadeOut();
}
function showM(comid){
	$('#screen-box-div').fadeIn();
	$('#submit-btn').fadeOut();
	$('#submit-btn_re').fadeIn();
	$('#other_submit-btn_re').val("");
	$('#other_submit-btn_re').val(comid);

}
function hideModal()
{
	$('#screen-box-div').fadeOut();
}
</script>

</body>
</html>